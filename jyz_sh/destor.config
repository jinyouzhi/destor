# Specify the working directory of destor.
# All metadata and data locate in the directory.
working-directory "./"

# Specify the simulation level: NO, RESTORE, APPEND, ALL.
# level 'all' indicates the inputs of destor are trace files generated by 'destor -t'
# other levels indicate the inputs are regular file.
#simulation-level all
simulation-level fsl


# Specify the trace format: TRACE_DESTOR, TRACE_FSL.
# "destor" indicates TRACE_DESTOR;
# "fsl" indicates TRACE_FSL
trace-format fsl

# Specify the destor verbosity level: debug, verbose, notice, warning.
log-level warning
#log-level verbose

# Specify the chunking algorithm.
# It can be rabin, fixed, "normalized rabin", file, ae.
# "file" indicates an approximiate file-level deduplication.
# For example, 
# chunk-algorithm "normalized rabin"
# chunk-algorithm file 
# chunk-algorithm fixed 
# chunk-algorithm tttd
chunk-algorithm rabin

# Specify the average/maximal/minmal chunk size in bytes.
#chunk-avg-size 4096
chunk-avg-size 4096
chunk-max-size 65536
chunk-min-size 512

####################################################################################
#                         Categories of fingerprint indexes
# -----------------------------------------------------------------------------------
# -                  -  physical locality  -            logical locality            -
# -----------------------------------------------------------------------------------
# - exact dedup      -   DDFS, ChunkStash  -         Block Locality Caching         -
# -----------------------------------------------------------------------------------
# - near-exact dedup -   Sampled Index     -    Extreme Binning, Sparse Index, SiLo -
# -----------------------------------------------------------------------------------
####################################################################################

# Specify the fingerprint index.
# It can be ddfs, silo, "extreme-binning", "sparse-index", 
#    "sampled-index", "block-locality-caching".
# For example, 
# fingerprint-index near-exact logical "extreme-binning"
#fingerprint-index near-exact logical "sparse-index"
#fingerprint-index near-exact logical "silo"
# (The fourth arg specifies a combo)
#fingerprint-index near-exact physical "sampled-index"
fingerprint-index near-exact logical "learn"


# Specify the fingerprint cache size
# in the size of container (only metadata part) or segmentRecipe.
fingerprint-index-cache-size 128

# Specify the key-value store
fingerprint-index-key-value htable

# Configure the key-value store
# The size of a feature in byte
fingerprint-index-key-size 20

# Specify the maximum number of segments a fingerprint in htable can refer to.
# it is not used for learn
fingerprint-index-value-length 1

#-----------------for learn-------------------------#
# Specify the maximum number of segments a fingerprint in context table can refer to.
cst-index-value-length 4

# Specify the entry update policy of context table for learn
# "fifo" first in first out
# "min" the entry with the minimum score is replaced by a new segment
# update-segment-policy fifo
update-segment-policy min


# Specify the segment selection method to prefetch for learn:
# PARTIAL_GREEDY_SELECT(greedy), RANDOM_SELECT(random) and RECENT_SELECT(recent)
#segment-select-method random
segment-select-method greedy 0.3
#segment-select-method recent
#---------------------------------------------------#

# Specify the sampling method and ratio.
# For example,
#fingerprint-index-sampling-method min 0
# (min 0 indicates select a feature per segment or container.)
# fingerprint-index-sampling-method min 128
# fingerprint-index-sampling-method optmin 128
fingerprint-index-sampling-method random 128
# fingerprint-index-sampling-method uniform 1
# fingerprint-index-sampling-method random 128


#########################################################################
#            Design elements of fingerprint indexes exploiting similarity
# --------------------------------------------------------------------------------------
# -                      -   Extreme Binning  -  Sparse Index    -   SiLo     - BLC    -
# - segment algorithm    -     file-defined   - content-defined  -   fixed    - fixed  -
# - sampling method      -     min            -    random        -   min      - (no)   -
# - segment selection    -     all            -    top-k         -   top-1    - base   -
# - segment prefetching  -     no             -    no            -   yes      - yes    -
# --------------------------------------------------------------------------------------
#########################################################################

# Specify the segment algorithm and the segment size. Such as
# fingerprint-index-segment-algorithm file-defined 
# fingerprint-index-segment-algorithm content-defined 512
fingerprint-index-segment-algorithm fixed 1024 
#fingerprint-index-segment-algorithm content-defined 1024

# Specify the min and max length of a segment, in terms of # of chunks.
fingerprint-index-segment-boundary 128 10240

# Specify the method of segment selection 
# for example,
# fingerprint-index-segment-selection top 2
# fingerprint-index-segment-selection base 
# fingerprint-index-segment-selection mix

# Specify the number of prefetched segments.
# 1 indicates only prefetching the required segment. 
fingerprint-index-segment-prefetching 4

# Specify the rewriting algorithm and the size of rewrite buffer.
# It can be "no", "cfl-based selective deduplication" (or "cfl" in short),
#   "context-based rewriting" (or cbr), "capping" (or cap).
# For example,
# rewrite-algorithm cbr 2048
rewrite-algorithm no

# Enable/disable the cfl switch.
# If the cfl switch is enable,
# destor will monitor the CFL metric in real time,
# and stop rewriting out-of-order chunks if the CFL is high.
rewrite-enable-cfl-switch no

# Specify cfl-require in cfl.
rewrite-cfl-require 0.6

# Specify cfl-usage-threshold in cfl.
rewrite-cfl-usage-threshold 0.03

# Specify rewrite limit in cbr.
rewrite-cbr-limit 0.05

# Specify minimal utility in cbr.
rewrite-cbr-minimal-utility 0.5

# Specify capping level in capping.
# The original definition of capping level (in the paper) is defined as rewrite-capping-level:rewrite buffer size. 
rewrite-capping-level 14

# Enable History-Aware Rewriting (HAR),
# rewrite-enable-har yes
rewrite-enable-har no

# Specify the utilization threshold of HAR.
rewrite-har-utilization-threshold 0.5
# Specify the rewrite limit of har.
# rewrite-har-rewrite-limit 0.05
rewrite-har-rewrite-limit 0.05

# Enable Cache-Aware Filter.
rewrite-enable-cache-aware no

# Specify the restore cache,
# and the size of the restore cache in the number of containers.
# It can be lru, "optimal cache" (or opt), "pattern", and "forward assembly" (or asm).
# note that in case of 'pattern', it follows the number of containers 
restore-cache pattern 0

# Specify the window size of the optimal restore cache.
restore-opt-window-size 1000000

# Specify the meta data cache size 
# it means the number of meta data of containers
# stored in this cache
# it is only valid in pattern restore
# it always be greater than zero
size-of-meta-cache 5000

# Specify if at least the percent of read chunks in a container, 
# the container is cached into the data cache 
# it is only valid in pattern restore
prefetch-container-percent 0.7

# Specify the most interval between two patterns
# it is only valid in pattern restore
wildcard-length 30

# Configuration of the maximum number of backups retained at any moment.
# The expired backup is deleted automatically.
# A value of 500 indicates only the recent 200 backups are retained.
# A negative value, such as -1, indicates all backups are retained.
backup-retention-time -1

# temp reserved variable
# Specify whether to use data cache in pattern-based restore
# if it is '0', it indicates to not use the data cache
# otherwise it is the size of data cache (# of chunks)
# num-chunks-in-data-cache 50
